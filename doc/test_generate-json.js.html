<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>test/generate-json.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-test_generate-json.html">test/generate-json</a></li><li><a href="module-test_regression-runner.html">test/regression-runner</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">test/generate-json.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node

/**
 * @file Generates JSON representation of molecular graph data from SMILES strings for regression testing.
 * @module test/generate-json
 * @description
 * This script parses a SMILES string using SmilesDrawer and extracts the molecular graph structure
 * (vertices and edges with all their properties) as JSON. The JSON output is deterministic and can
 * be compared between different versions of the code to detect regressions.
 *
 * The graph data includes:
 * - Vertices: atom positions, elements, angles, directions, and connectivity
 * - Edges: bond types, aromatic ring membership, wedge stereochemistry
 *
 * @example
 * // Generate JSON to stdout
 * node test/generate-json.js "CCO"
 *
 * @example
 * // Generate JSON to file
 * node test/generate-json.js "CCO" /tmp/output.json
 */

const { JSDOM } = require('jsdom');
const fs = require('fs');

const smilesInput = process.argv[2];
const outputFile = process.argv[3];

if (!smilesInput) {
    console.error('ERROR: No SMILES string provided');
    console.error('Usage: node generate-json.js "&lt;SMILES>" [output-file]');
    process.exit(2);
}

console.log(`PROCESSING: ${smilesInput}`);

const dom = new JSDOM('&lt;!DOCTYPE html>&lt;html>&lt;body>&lt;/body>&lt;/html>');
global.window = dom.window;
global.document = dom.window.document;
global.navigator = dom.window.navigator;

const SmilesDrawer = require('../app.js');

const options = {
    width: 500,
    height: 500,
    bondThickness: 1.0,
    bondLength: 30,
    shortBondLength: 0.85,
    bondSpacing: 0.18 * 30,
    atomVisualization: 'default',
    isomeric: true,
    debug: false,
    terminalCarbons: false,
    explicitHydrogens: false,
    overlapSensitivity: 0.42,
    overlapResolutionIterations: 1,
    compactDrawing: true,
    fontFamily: 'Arial, Helvetica, sans-serif',
    fontSizeLarge: 6,
    fontSizeSmall: 4,
    padding: 20.0,
    experimental: false,
    themes: {
        dark: {
            C: '#fff',
            O: '#e74c3c',
            N: '#3498db',
            F: '#27ae60',
            CL: '#16a085',
            BR: '#d35400',
            I: '#8e44ad',
            P: '#d35400',
            S: '#f39c12',
            B: '#e67e22',
            SI: '#e67e22',
            H: '#aaa',
            BACKGROUND: '#141414'
        },
        light: {
            C: '#222',
            O: '#e74c3c',
            N: '#3498db',
            F: '#27ae60',
            CL: '#16a085',
            BR: '#d35400',
            I: '#8e44ad',
            P: '#d35400',
            S: '#f39c12',
            B: '#e67e22',
            SI: '#e67e22',
            H: '#999',
            BACKGROUND: '#fff'
        }
    }
};

try {
    console.log('PARSING: Starting parse');
    const svgDrawer = new SmilesDrawer.SvgDrawer(options);

    SmilesDrawer.parse(smilesInput, function(tree) {
        console.log('PARSE_SUCCESS: Tree generated');

        console.log('PROCESSING: Generating graph data');

        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
        svg.setAttribute('width', String(options.width));
        svg.setAttribute('height', String(options.height));

        const drawData = svgDrawer.draw(tree, svg, 'light', false);

        const graph = svgDrawer.preprocessor.graph;
        const graphData = {
            vertices: graph &amp;&amp; graph.vertices ? graph.vertices.map(v => ({
                id: v.id,
                value: v.value,
                position: v.position,
                positioned: v.positioned,
                angle: v.angle,
                dir: v.dir,
                neighbourCount: v.neighbours ? v.neighbours.length : 0,
                edges: v.edges ? v.edges.map(e => e.id) : []
            })) : [],
            edges: graph &amp;&amp; graph.edges ? graph.edges.map(e => ({
                id: e.id,
                sourceId: e.sourceId,
                targetId: e.targetId,
                bondType: e.bondType,
                isPartOfAromaticRing: e.isPartOfAromaticRing,
                center: e.center,
                wedge: e.wedge
            })) : []
        };

        console.log('PROCESS_SUCCESS: Graph data extracted');

        const jsonOutput = JSON.stringify(graphData, null, 2);

        if (outputFile) {
            fs.writeFileSync(outputFile, jsonOutput, 'utf8');
            console.log('JSON written to: ' + outputFile);
            console.log('JSON length: ' + jsonOutput.length + ' bytes');
        } else {
            console.log('JSON_START_MARKER');
            console.log(jsonOutput);
            console.log('JSON_END_MARKER');
        }

        process.exit(0);
    }, function(err) {
        console.error('PARSE_ERROR: ' + err);
        process.exit(1);
    });
} catch (err) {
    console.error('FATAL_ERROR: ' + err.message);
    console.error(err.stack);
    process.exit(1);
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Mon Nov 03 2025 11:56:15 GMT+1100 (Australian Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
